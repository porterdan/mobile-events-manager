var tmem_admin_vars;jQuery(document).ready(function(a){function b(){if("manual"===a("#venue_id").val()||"client"===a("#venue_id").val())a(".tmem-event-venue-details-sections-wrap").hide("fast"),a(".tmem-add-event-venue-sections-wrap").show("fast");else{a(".tmem-add-event-venue-sections-wrap").hide("fast");var b={venue_id:a("#venue_id").val(),event_id:a("#post_ID").val(),action:"tmem_refresh_venue_details"};a.ajax({type:"POST",dataType:"json",data:b,url:ajaxurl,success:function(b){a("#tmem-venue-details-fields").html(b.data.venue),a(".tmem-event-venue-details-sections-wrap").show("fast");var c=a(".toggle-event-view-venue-option-section").html()===tmem_admin_vars.show_venue_details;c&&a(".toggle-event-view-venue-option-section").html(tmem_admin_vars.hide_venue_details)}}).fail(function(a){window.console&&window.console.log&&console.log(a)}),e()}a("#_tmem_event_package").trigger("change")}a(".tmem-select-chosen").chosen({inherit_select_classes:!0,placeholder_text_single:tmem_admin_vars.one_option,placeholder_text_multiple:tmem_admin_vars.one_or_more_option}),a(".tmem-select-chosen .chosen-search input").each(function(){var b=a(this).parent().parent().parent().prev("select.tmem-select-chosen"),c=b.data("search-placeholder");a(this).attr("placeholder",c)}),a(".chosen-choices").on("click",function(){var b=a(this).parent().prev().data("search-placeholder");"undefined"==typeof b&&(b=tmem_admin_vars.type_to_search),a(this).children("li").children("input").attr("placeholder",b)}),a(document).on("click",".notice-tmem-dismiss .notice-dismiss",function(){var b=a(this).closest(".notice-tmem-dismiss").data("notice"),c={notice:b,action:"tmem_dismiss_notice"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl})});var c=function(){var b=a("#_tmem_event_deposit").val(),c={current_cost:a("#_tmem_event_cost").val(),action:"update_event_deposit"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a("#_tmem_event_deposit").attr("readonly",!0),a("#tmem-event-pricing-detail").addClass("tmem-mute")},success:function(c){"success"===c.type?a("#_tmem_event_deposit").val(c.deposit):(alert(c.msg),a("#_tmem_event_deposit").val(b)),a("#tmem-event-pricing-detail").removeClass("tmem-mute"),a("#_tmem_event_deposit").attr("readonly",!1)}}).fail(function(c){window.console&&window.console.log&&console.log(c),a("#_tmem_event_deposit").val(b)})},d=function(){var b,d=a("#_tmem_event_cost").val();b="manual"===a("#venue_id").val()||"client"===a("#venue_id").val()?[a("#venue_address1").val(),a("#venue_address2").val(),a("#venue_town").val(),a("#venue_county").val(),a("#venue_postcode").val()]:a("#venue_id").val();var e={addons:a("#event_addons").val()||[],package:a("#_tmem_event_package option:selected").val(),event_id:a("#post_ID").val(),current_cost:a("#_tmem_event_cost").val(),event_date:a("#_tmem_event_date").val(),venue:b,employee_id:a("#_tmem_event_dj").val(),additional:a("#_tmem_event_additional_cost").val(),discount:a("#_tmem_event_discount").val(),action:"tmem_update_event_cost"};a.ajax({type:"POST",dataType:"json",data:e,url:ajaxurl,beforeSend:function(){a("#tmem-event-pricing-detail").addClass("tmem-mute")},success:function(b){if("success"===b.type){a("#_tmem_event_package_cost").val(b.package_cost),a("#_tmem_event_addons_cost").val(b.addons_cost),a("#_tmem_event_travel_cost").val(b.travel_cost),a("#_tmem_event_additional_cost").val(b.additional_cost),a("#_tmem_event_discount").val(b.discount);var e=Number(b.package_cost)+Number(b.addons_cost)+Number(b.travel_cost)+Number(b.additional_cost);e=Number(e)-Number(b.discount),e=e.toFixed(2),a("#_tmem_event_cost").val(e),tmem_admin_vars.update_deposit&&c()}else a("#_tmem_event_cost").val(d);a("#tmem-event-pricing-detail").removeClass("tmem-mute")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})},e=function(){var b;b="manual"===a("#venue_id").val()||"client"===a("#venue_id").val()?[a("#venue_address1").val(),a("#venue_address2").val(),a("#venue_town").val(),a("#venue_county").val(),a("#venue_postcode").val()]:a("#venue_id").val();var c={employee_id:a("#_tmem_event_dj").val(),venue:b,action:"tmem_update_travel_data"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,success:function(b){"success"===b.type?(a(".tmem-travel-distance").parents("tr").show(),a(".tmem-travel-directions").parents("tr").show(),a(".tmem-travel-distance").html(b.distance),a(".tmem-travel-time").html(b.time),a(".tmem-travel-cost").html(b.cost),a("#travel_directions").attr("href",b.directions_url),a("#tmem_travel_distance").val(b.distance),a("#tmem_travel_time").val(b.time),a("#tmem_travel_cost").val(b.raw_cost),a("#tmem_travel_directions_url").val(b.directions_url)):(a(".tmem-travel-distance").parents("tr").hide(),a("#travel-directions").attr("href",""),a(".tmem-travel-directions").parents("tr").hide(),a("#tmem_travel_distance").val(""),a("#tmem_travel_time").val(""),a("#tmem_travel_cost").val(""),a("#tmem_travel_directions_url").val(""))}}).fail(function(a){window.console&&window.console.log&&console.log(a)})},f={init:function(){this.general(),"admin_page_tmem-custom-event-fields"!==tmem_admin_vars.current_page&&"admin_page_tmem-custom-client-fields"!==tmem_admin_vars.current_page||this.custom_fields()},general:function(){var b=a(".tmem-color-picker");b.length&&b.wpColorPicker()},custom_fields:function(){jQuery(document).ready(function(a){a(".tmem-client-list-item").sortable({handle:".tmem_draghandle",items:".tmem_sortable_row",opacity:.6,cursor:"move",axis:"y",update:function(){var b=a(this).sortable("serialize",{expression:/(.+)=(.+)/})+"&action=tmem_update_client_field_order";a.post(ajaxurl,b,function(){})}})}),a(".tmem-custom-client-list-item,.tmem-custom-event-list-item,.tmem-custom-venue-list-item").sortable({handle:".tmem_draghandle",items:".tmem_sortable_row",opacity:.6,cursor:"move",axis:"y",update:function(){var b=a(this).sortable("serialize")+"&action=order_custom_event_fields";a.post(ajaxurl,b,function(){})}})}};f.init();var g={init:function(){this.options(),this.absence(),this.checker()},options:function(){a(document.body).on("click",".toggle-availability-checker-section",function(b){b.preventDefault();var c=a(this).html()===tmem_admin_vars.show_avail_form;c?a(this).html(tmem_admin_vars.hide_avail_form):a(this).html(tmem_admin_vars.show_avail_form),a(".tmem-availability-checker-fields").slideToggle()}),a(document.body).on("click",".toggle-add-absence-section",function(b){b.preventDefault();var c=a(this).html()===tmem_admin_vars.show_absence_form;c?a(this).html(tmem_admin_vars.hide_absence_form):a(this).html(tmem_admin_vars.show_absence_form);var d=a(this).parents(".tmem-availability-row-header");d.siblings(".tmem-availability-add-absence-sections-wrap").slideToggle(),a("#absence_all_day").is(":checked")&&(a(".tmem-absence-start-time-option").hide("fast"),a(".tmem-absence-end-time-option").hide("fast"));var e;e=c?a(":input:not(input[type=button],input[type=submit],button):visible:first",d.siblings(".tmem-availability-add-absence-sections-wrap")):a(":input:not(input[type=button],input[type=submit],button):visible:first",d.siblings(".tmem-repeatable-row-standard-fields")),e.focus()}),a(document.body).on("change","#absence_all_day",function(){a(".tmem-absence-start-time-option").slideToggle(),a(".tmem-absence-end-time-option").slideToggle()})},absence:function(){a(document.body).on("click","#add-absence",function(b){b.preventDefault();var c=a("#absence_employee_id").val(),d=a("#absence_start").val(),e=a("#absence_end").val(),f=a("#absence_all_day").is(":checked")?1:0,g=a("#absence_start_time_hr").val(),h=a("#absence_start_time_min").val(),i=0,j=a("#absence_end_time_hr").val(),k=a("#absence_end_time_min").val(),l=0,m=a("#absence_notes").val();if("H:i"!==tmem_admin_vars.time_format&&(i=a("#absence_start_time_period").val(),l=a("#absence_end_time_period").val()),!d)return void a("#display_absence_start").addClass("tmem-form-error");if(!e)return void a("#display_absence_end").addClass("tmem-form-error");var n={employee_id:c,start_date:d,end_date:e,all_day:f,start_time_hr:g,start_time_min:h,start_time_period:i,end_time_hr:j,end_time_min:k,end_time_period:l,notes:m,action:"tmem_add_employee_absence"};a.ajax({type:"POST",dataType:"json",data:n,url:ajaxurl,beforeSend:function(){a("#tmem-add-absence-fields").addClass("tmem-mute")},success:function(b){!0===b.success&&(a("#tmem-calendar").fullCalendar("refetchEvents"),a("#tmem-calendar").fullCalendar("gotoDate",b.date)),a("#display_absence_start").val(""),a("#absence_start").val(""),a("#display_absence_end").val(""),a("#absence_end").val(""),a("#absence_all_day").prop("checked, true"),a("#absence_start_time_hr").val("00"),a("#absence_start_time_min").val("00"),a("#absence_end_time_hr").val("00"),a("#absence_end_time_min").val("00"),a("#absence_notes").val(""),"H:i"!==tmem_admin_vars.time_format&&(a("#absence_start_time_period").val("am"),a("#absence_end_time_period").val("am")),a("#tmem-calendar").removeClass("tmem-mute"),a("#tmem-add-absence-fields").removeClass("tmem-mute"),a("html, body").animate({scrollTop:a(".toggle-add-absence-section").offset().top},500),a(".toggle-add-absence-section").trigger("click")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})}),a(document.body).on("click",".delete-absence",function(b){b.preventDefault(),a("#tmem-calendar").addClass("tmem-mute");var c={id:a(this).data("entry"),action:"tmem_delete_employee_absence"};a.ajax({type:"POST",url:ajaxurl,dataType:"json",data:c,success:function(b){!0===b.success&&(a("#tmem-calendar").fullCalendar("refetchEvents"),a(".popover").hide("fast")),a("#tmem-calendar").removeClass("tmem-mute")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})})},checker:function(){a(document.body).on("click","#check-availability",function(){var b=a("#check_date"),c=a("#display_date"),d=a("#display_date"),e=a("#check_roles");if(!b.val()||!c.val())return void c.addClass("tmem-form-error");var f={date:b,employees:d,roles:e,action:"do_availability_check_ajax"};a.ajax({type:"POST",dataType:"json",data:f,url:ajaxurl,beforeSend:function(){a("#tmem_availability_fields").addClass("tmem-mute")},success:function(){a("#tmem_availability_fields").removeClass("tmem-mute")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})})}};g.init();var h={init:function(){this.options(),this.client(),this.employee(),this.equipment(),this.playlist(),this.tasks(),this.time(),this.travel(),this.type(),this.txns(),this.venue()},options:function(){a(document.body).on("click",".toggle-event-options-section",function(b){b.preventDefault();var c=a(this).html()===tmem_admin_vars.show_event_options;c?a(this).html(tmem_admin_vars.hide_event_options):a(this).html(tmem_admin_vars.show_event_options),a(".tmem-event-options-sections-wrap").slideToggle()})},client:function(){a(document.body).on("click",".toggle-client-add-option-section",function(b){b.preventDefault();var c=a(this).html()===tmem_admin_vars.show_client_form;c?a(this).html(tmem_admin_vars.hide_client_form):a(this).html(tmem_admin_vars.show_client_form);var d=a(this).parents(".tmem-client-row-header");d.siblings(".tmem-client-add-event-sections-wrap").slideToggle();var e;e=c?a(":input:not(input[type=button],input[type=submit],button):visible:first",d.siblings(".tmem-client-add-event-sections-wrap")):a(":input:not(input[type=button],input[type=submit],button):visible:first",d.siblings(".tmem-repeatable-row-standard-fields")),e.focus()}),a(document.body).on("click",".toggle-client-details-option-section",function(b){b.preventDefault();var c=a(this).html()===tmem_admin_vars.show_client_details;c?a(this).html(tmem_admin_vars.hide_client_details):a(this).html(tmem_admin_vars.show_client_details);var d=a(this).parents(".tmem-client-row-header");d.siblings(".tmem-client-details-event-sections-wrap").slideToggle();var e;c||(e=a(":input:not(input[type=button],input[type=submit],button):visible:first",d.siblings(".tmem-repeatable-row-standard-fields")),e.focus())}),a(document.body).on("click","#toggle_client_details",function(){a("#tmem-event-client-details").toggle("slow")}),a(document.body).on("change","#client_name",function(b){if(b.preventDefault(),""===a("#client_name").val())return void a("#tmem-event-add-new-client-fields").hide("slow");if("tmem_add_client"===a("#client_name").val())a("#tmem-event-add-new-client-fields").show("slow");else{a("#tmem-event-add-new-client-fields").hide("slow");var c={client_id:a("#client_name").val(),event_id:a("#post_ID").val(),action:"tmem_refresh_client_details"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a("#tmem-event-client-details").replaceWith('<div id="tmem-loading" class="tmem-loader"><img src="'+tmem_admin_vars.ajax_loader+'" /></div>')},success:function(b){a("#tmem-loading").replaceWith(b.client_details)}}).fail(function(b){a("#tmem-event-client-details").replaceWith('<div id="tmem-loading" class="tmem-loader"><img src="'+tmem_admin_vars.ajax_loader+'" /></div>'),window.console&&window.console.log&&console.log(b)})}}),a(document.body).on("click","#tmem-add-client",function(b){if(b.preventDefault(),a("#client_firstname").val().length<1)return void a("#client_firstname").addClass("tmem-form-error");if(a("#client_email").val().length<1)return void a("#client_email").addClass("tmem-form-error");var c={client_firstname:a("#client_firstname").val(),client_lastname:a("#client_lastname").val(),client_email:a("#client_email").val(),client_address1:a("#client_address1").val(),client_address2:a("#client_address2").val(),client_town:a("#client_town").val(),client_county:a("#client_county").val(),client_postcode:a("#client_postcode").val(),client_phone:a("#client_phone").val(),client_phone2:a("#client_phone2").val(),action:"tmem_event_add_client"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a(".tmem-client-option-fields").addClass("tmem-mute"),a("#tmem-add-client").hide("fast")},success:function(b){a("#tmem-add-client-fields").slideToggle(),a("#add-client-action").html(tmem_admin_vars.show_client_form),a("#client_name").empty(),a("#client_firstname").val(""),a("#client_lastname").val(""),a("#client_email").val(""),a("#client_address1").val(""),a("#client_address2").val(""),a("#client_town").val(""),a("#client_county").val(""),a("#client_postcode").val(""),a("#client_phone").val(""),a("#client_phone2").val(""),a("#client_name").append(b.client_list),a("#tmem-add-client").show("fast"),a("#_tmem_event_block_emails").prop("checked",!1),a("#tmem_reset_pw").prop("checked",!0),a("#client_name").trigger("chosen:updated"),a(".tmem-client-option-fields").removeClass("tmem-mute"),"error"===b.type&&alert(b.message)}}).fail(function(a){window.console&&window.console.log&&console.log(a)})}),a(document.body).on("click","#toggle_custom_client_fields",function(){a("#tmem_event_custom_client_fields").toggle("fast")}),a(document.body).on("click","#toggle_custom_event_fields",function(){a("#tmem_event_custom_event_fields").toggle("fast")}),a(document.body).on("click","#toggle_custom_venue_fields",function(){a("#tmem_event_custom_venue_fields").toggle("fast")})},employee:function(){a(document.body).on("click","#new_tmem_role",function(b){if(b.preventDefault(),a("#add_tmem_role").hasClass("tmem-form-error")&&a("#add_tmem_role").removeClass("tmem-form-error"),a("#add_tmem_role").val().length<1)return void a("#add_tmem_role").addClass("tmem-form-error");var c={role_name:a("#add_tmem_role").val(),action:"tmem_add_role"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a('input[type="submit"]').prop("disabled",!0),a("#new_tmem_role").hide(),a("#pleasewait").show(),a("#all_roles").addClass("tmem-mute"),a("#employee_role").addClass("tmem-mute"),a("#all_roles").fadeTo("slow",.5),a("#employee_role").fadeTo("slow",.5)},success:function(b){"success"===b.type?(a("#all_roles").empty(),a("#employee_role").empty(),a("#all_roles").append(b.options),a("#employee_role").append(b.options),a("#add_tmem_role").val(""),a("#all_roles").fadeTo("slow",1),a("#all_roles").removeClass("tmem-mute"),a("#employee_role").fadeTo("slow",1),a("#employee_role").removeClass("tmem-mute"),a('input[type="submit"]').prop("disabled",!1),a("#pleasewait").hide(),a("#new_tmem_role").show()):(alert(b.msg),a("#all_roles").fadeTo("slow",1),a("#all_roles").removeClass("tmem-mute"),a("#employee_role").fadeTo("slow",1),a("#employee_role").removeClass("tmem-mute"),a('input[type="submit"]').prop("disabled",!1),a("#pleasewait").hide(),a("#new_tmem_role").show())}})}),a(document.body).on("click",".toggle-add-worker-section",function(b){b.preventDefault();var c=a(this).html()===tmem_admin_vars.show_workers;c?a(this).html(tmem_admin_vars.hide_workers):a(this).html(tmem_admin_vars.show_workers),a(".tmem-event-workers-sections-wrap").slideToggle(),a(".tmem-event-workers-sections-wrap").is(":visible")&&a("#event_new_employee_role").focus()}),a(document.body).on("change","#event_new_employee_wage",function(){var b=a(this).val();b.length>0&&a(this).val(b.toFixed(2))}),a(document.body).on("click","#add_event_employee",function(b){b.preventDefault();var c={event_id:a("#post_ID").val(),employee_id:a("#event_new_employee").val(),employee_role:a("#event_new_employee_role").val(),employee_wage:a("#event_new_employee_wage").val(),action:"add_employee_to_event"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a(".tmem-event-workers-sections-wrap").addClass("tmem-mute"),a("#tmem-event-employee-list").slideToggle()},success:function(b){"success"!==b.type&&alert(b.msg),a("#tmem-event-employee-list").html(b.employees),a("#tmem-event-employee-list").slideToggle(),a(".tmem-event-workers-sections-wrap").removeClass("tmem-mute"),a("#event_new_employee_role").val("").trigger("chosen:updated"),a("#event_new_employee").val("").trigger("chosen:updated"),a("#event_new_employee_wage").val("")}}).fail(function(b){a("#tmem-event-employee-list").slideToggle(),a(".tmem-event-workers-sections-wrap").removeClass("tmem-mute"),window.console&&window.console.log&&console.log(b)})}),a(document.body).on("click",".remove_event_employee",function(b){b.preventDefault();var c={event_id:a("#post_ID").val(),employee_id:a(this).data("employee_id"),action:"remove_employee_from_event"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a(".tmem-event-workers-sections-wrap").addClass("tmem-mute"),a("#tmem-event-employee-list").slideToggle()},success:function(b){"success"!==b.type&&alert("Error"),a("#tmem-event-employee-list").html(b.employees),a("#tmem-event-employee-list").slideToggle(),a(".tmem-event-workers-sections-wrap").removeClass("tmem-mute")}}).fail(function(b){a("#tmem-event-employee-list").slideToggle(),a(".tmem-event-workers-sections-wrap").removeClass("tmem-mute"),window.console&&window.console.log&&console.log(b)})})},equipment:function(){a(document.body).on("change","#_tmem_event_package,#event_addons,#_tmem_event_additional_cost,#_tmem_event_discount",function(){d()}),a(document.body).on("focusout","#_tmem_event_cost",function(){tmem_admin_vars.deposit_is_pct&&c()}),a(document.body).on("change","#_tmem_event_dj,#tmem_event_type,#display_event_date",function(b){b.preventDefault();var c=a("#_tmem_event_deposit").val(),e={package:a("#_tmem_event_package option:selected").val(),addons:a("#event_addons").val()||[],employee:a("#_tmem_event_dj").val(),event_type:a("#tmem_event_type").val(),event_date:a("#_tmem_event_date").val(),action:"refresh_event_package_options"};a.ajax({type:"POST",dataType:"json",data:e,url:ajaxurl,beforeSend:function(){a("#tmem-event-equipment-row").hide(),a("#tmem-equipment-loader").show()},success:function(b){"success"===b.type?(a("#_tmem_event_package").empty(),a("#_tmem_event_package").append(b.packages),a("#_tmem_event_package").trigger("chosen:updated"),a("#event_addons").empty(),a("#event_addons").append(b.addons),a("#event_addons").trigger("chosen:updated"),a("#tmem-equipment-loader").hide(),a("#tmem-event-equipment-row").show(),d()):alert(b.msg),a("#tmem-equipment-loader").hide(),a("#tmem-event-equipment-row").show()}}).fail(function(b){window.console&&window.console.log&&console.log(b),a("#_tmem_event_deposit").val(c)})}),a(document.body).on("change","#_tmem_event_package",function(b){b.preventDefault();var c={package:a("#_tmem_event_package option:selected").val(),employee:a("#_tmem_event_dj").val(),event_type:a("#tmem_event_type").val(),event_date:a("#_tmem_event_date").val(),selected:a("#event_addons").val()||[],action:"refresh_event_addon_options"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a("#tmem-event-equipment-row").hide(),a("#tmem-equipment-loader").show()},success:function(b){"success"===b.type?(a("#event_addons").empty(),a("#event_addons").append(b.addons),a("#event_addons").trigger("chosen:updated"),d(),a("#tmem-equipment-loader").hide(),a("#tmem-event-equipment-row").show()):alert(b.msg),a("#tmem-equipment-loader").hide(),a("#tmem-event-equipment-row").show()}}).fail(function(a){window.console&&window.console.log&&console.log(a)})})},playlist:function(){a(document.body).on("change","#_tmem_event_playlist",function(){a("#tmem-playlist-limit").toggle("fast")})},tasks:function(){a(document.body).on("change","#tmem_event_task",function(){var b=a(this).val();"0"===b?a("#tmem-event-task-run").addClass("tmem-hidden"):a("#tmem-event-task-run").removeClass("tmem-hidden")}),a(document.body).on("click","#tmem-run-task",function(b){b.preventDefault(),a("#tmem-event-tasks").addClass("tmem-mute");var c=a("#tmem_event_task").val(),d=a("#post_ID").val();if("reject-enquiry"===c){var e=a("#client_name").val(),f={page:"tmem-comms",recipient:e,template:tmem_admin_vars.unavailable_template,event_id:d,"tmem-action":"respond_unavailable"},g=tmem_admin_vars.admin_url+"admin.php?";return void(window.location.href=g+a.param(f))}var h={event_id:d,task:c,action:"tmem_execute_event_task"};a.ajax({type:"POST",dataType:"json",data:h,url:ajaxurl,beforeSend:function(){a("#tmem-run-task").addClass("tmem-hidden"),a("#tmem-spinner").css("visibility","visible")},complete:function(){a("#tmem-event-tasks").removeClass("tmem-mute")},success:function(b){b.success?(a("#tmem-event-task-run").addClass("tmem-hidden"),a("#tmem_event_status").val(b.data.status),a("#tmem_event_status").trigger("chosen:updated"),a(".task-history-items").html(b.data.history),a(".task-history-items").removeClass("description"),a("#tmem-run-task").removeClass("tmem-hidden"),a("#tmem_event_task").val("0"),a("#tmem_event_task").trigger("chosen:updated"),a("#tmem-spinner").css("visibility","hidden")):alert("Error")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})})},time:function(){a(document.body).on("change","#display_event_date",function(){a("#dj_setup_date").val().length<1&&a("#dj_setup_date").val(a("#display_event_date").val())}),tmem_admin_vars.setup_time_interval&&a(document.body).on("change","#event_start_hr, #event_start_min, #event_start_period",function(){var b=a("#event_start_hr").val(),c=a("#event_start_min").val(),d="",e=a("#_tmem_event_date").val();"H:i"!==tmem_admin_vars.time_format&&(d=" "+a("#event_start_period").val());var f=b+":"+c+d,g={time:f,date:e,action:"tmem_event_setup_time"};a.ajax({type:"POST",dataType:"json",data:g,url:ajaxurl,success:function(b){a("#dj_setup_hr").val(b.data.hour),a("#dj_setup_min").val(b.data.minute),"H:i"!==tmem_admin_vars.time_format&&a("#dj_setup_period").val(b.data.meridiem),(a("#dj_setup_date").val().length<1||a("#dj_setup_date").val()!==b.data.date)&&(a("#dj_setup_date").val(b.data.date),a("#_tmem_event_djsetup").val(b.data.datepicker))}}).fail(function(a){window.console&&window.console.log&&console.log(a)})})},travel:function(){a(document.body).on("change","#venue_id",function(){"client"===a("#venue_id").val()&&b()}),a(document.body).on("change","#_tmem_event_dj,#venue_address1,#venue_address2,#venue_town,#venue_county,#venue_postcode",function(){e(),a("#_tmem_event_package").trigger("change")});var b=function(){if(a("#client_name").length){var b=a("#client_name").val(),c={client_id:b,action:"tmem_set_client_venue"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,success:function(b){b.address1&&a("#venue_address1").val(b.address1),b.address2&&a("#venue_address2").val(b.address2),b.town&&a("#venue_town").val(b.town),b.county&&a("#venue_county").val(b.county),b.postcode&&a("#venue_postcode").val(b.postcode),setTimeout(function(){e()},1e3),setTimeout(function(){d()},1750)}}).fail(function(a){window.console&&window.console.log&&console.log(a)})}}},type:function(){a(document.body).on("click",".toggle-event-type-option-section",function(b){b.preventDefault(),a(".tmem-add-event-type-sections-wrap").slideToggle(),a(".tmem-add-event-type-sections-wrap").is(":visible")&&a("#event_type_name").focus()}),a(document.body).on("click","#tmem-add-event-type",function(b){b.preventDefault();var c={type:a("#event_type_name").val(),current:a("#tmem_event_type").val(),action:"add_event_type"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a(".tmem-event-option-fields").addClass("tmem-mute"),a("#tmem-add-event-type").hide("fast")},success:function(b){if(b){if("success"!==b.data.msg)return a("#event_type_name").addClass("tmem-form-error"),void a("#tmem-add-event-type").show("fast");a("#event_type_name").val(""),a(".tmem-add-event-type-sections-wrap").slideToggle(),a("#tmem_event_type").empty(),a("#tmem_event_type").append(b.data.event_types),a("#tmem_event_type").trigger("chosen:updated"),a("#tmem-add-event-type").show("fast"),a(".tmem-event-option-fields").removeClass("tmem-mute")}else alert(b.data.msg),a("#tmem-add-event-type").show("fast")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})}),a(document.body).on("click","#tmem_block_emails",function(){a(".tmem-quote-template").toggle("fast")})},txns:function(){a(document.body).on("click","#tmem_txn_toggle",function(){a("#tmem_event_txn_table").toggle("slow")}),a(document.body).on("click","#toggle_add_txn_fields",function(){a("#tmem_event_add_txn_table tbody").toggle("slow"),a("#save-event-txn").toggle("fast"),"show form"===a("#toggle_add_txn_fields").text()?a("#toggle_add_txn_fields").text("hide form"):a("#toggle_add_txn_fields").text("show form")}),a(document.body).on("change","#tmem_txn_direction",function(){"In"===a("#tmem_txn_direction").val()&&(a("#tmem_txn_from_container").removeClass("tmem-hidden"),a("#tmem_txn_to_container").addClass("tmem-hidden"),a("#tmem-txn-email").removeClass("tmem-hidden")),"Out"!==a("#tmem_txn_direction").val()&&""!==a("#tmem_txn_direction").val()||(a("#tmem_txn_to_container").removeClass("tmem-hidden"),a("#tmem_txn_from_container").addClass("tmem-hidden"),a("#tmem-txn-email").addClass("tmem-hidden"))}),a(document.body).on("click","#save_transaction",function(b){if(b.preventDefault(),a("#tmem_txn_amount").val().length<1)return alert(tmem_admin_vars.no_txn_amount),!1;if(a("#tmem_txn_date").val().length<1)return alert(tmem_admin_vars.no_txn_date),!1;if(a("#tmem_txn_for").val().length<1)return alert(tmem_admin_vars.no_txn_for),!1;if(a("#tmem_txn_src").val().length<1)return alert(tmem_admin_vars.no_txn_src),!1;var c={event_id:a("#post_ID").val(),client:a("#client_name").val(),amount:a("#tmem_txn_amount").val(),date:a("#tmem_txn_date").val(),direction:a("#tmem_txn_direction").val(),from:a("#tmem_txn_from").val(),to:a("#tmem_txn_to").val(),for:a("#tmem_txn_for").val(),src:a("#tmem_txn_src").val(),send_notice:a("#tmem_manual_txn_email").is(":checked")?1:0,action:"add_event_transaction"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a("#tmem_event_txn_table").replaceWith('<div id="tmem-loading" class="tmem-loader"><img src="'+tmem_admin_vars.ajax_loader+'" /></div>')},success:function(b){"success"===b.type?("Y"===b.deposit_paid&&a("#deposit_paid").prop("checked",!0),"Y"===b.balance_paid&&a("#balance_paid").prop("checked",!0),b.event_status!==a("#tmem_event_status").val()&&a("#tmem_event_status").val(b.event_status)):alert(b.msg),a("#tmem-loading").replaceWith('<div id="tmem_event_txn_table">'+b.transactions+"</div>")}}).fail(function(b){a("#tmem-loading").replaceWith('<div id="tmem_event_txn_table">'+response.transactions+"</div>"),window.console&&window.console.log&&console.log(b)})})},venue:function(){"post.php"===tmem_admin_vars.current_page&&"manual"===a("#venue_id").val()&&a(".tmem-add-event-venue-sections-wrap").show(),a(document.body).on("click",".toggle-event-view-venue-option-section",function(b){b.preventDefault();var c=a(this).html()===tmem_admin_vars.show_venue_details;c?a(this).html(tmem_admin_vars.hide_venue_details):a(this).html(tmem_admin_vars.show_venue_details),a(".tmem-event-venue-details-sections-wrap").slideToggle()}),a(document.body).on("click",".toggle-event-add-venue-option-section",function(b){b.preventDefault(),a(".tmem-add-event-venue-sections-wrap").slideToggle(),a(".tmem-add-event-venue-sections-wrap").is(":visible")&&a("#venue_name").focus()}),a(document.body).on("change","#venue_id",function(a){a.preventDefault(),b()}),a(document.body).on("click","#tmem-add-venue",function(c){if(c.preventDefault(),a("#venue_name").val().length<1)return void a("#venue_name").addClass("tmem-form-error");var d={venue_name:a("#venue_name").val(),venue_contact:a("#venue_contact").val(),venue_email:a("#venue_email").val(),venue_address1:a("#venue_address1").val(),venue_address2:a("#venue_address2").val(),venue_town:a("#venue_town").val(),venue_county:a("#venue_county").val(),venue_postcode:a("#venue_postcode").val(),venue_phone:a("#venue_phone").val(),action:"tmem_add_venue"};a.ajax({type:"POST",dataType:"json",data:d,url:ajaxurl,beforeSend:function(){a(".tmem-event-option-fields").addClass("tmem-mute"),a("#tmem-add-venue").hide("fast")},success:function(c){a(".tmem-add-event-venue-sections-wrap").slideToggle(),a("#venue_id").empty(),a("#venue_id").append(c.venue_list),a("#tmem-add-venue").show(),a("#venue_id").trigger("chosen:updated"),b(),a(".tmem-event-option-fields").removeClass("tmem-mute"),"error"===c.type&&(alert(c.message),a("#tmem-add-venue").show("fast"))}}).fail(function(b){a("#tmem-add-venue").show("fast"),window.console&&window.console.log&&console.log(b)})})}};h.init();var i={init:function(){this.add(),this.remove(),this.price()},clone_repeatable:function(b){var c=1,d=c;return b.parent().find("tr.tmem_repeatable_row").each(function(){var b=a(this).data("key");parseInt(b)>c&&(c=b)}),d=c+=1,clone=b.clone(),clone.find("select").each(function(){a(this).val(b.find('select[name="'+a(this).attr("name")+'"]').val())}),clone.removeClass("tmem_add_blank"),clone.attr("data-key",d),clone.find("td input, td select, textarea").val(""),clone.find("input, select, textarea").each(function(){var b=a(this).attr("name"),c=a(this).attr("id");b&&(b=b.replace(/\[(\d+)\]/,"["+parseInt(d)+"]"),a(this).attr("name",b)),"undefined"!=typeof c&&(c=c.replace(/(\d+)/,parseInt(d)),a(this).attr("id",c))}),clone.find("span.tmem_price_id").each(function(){a(this).text(parseInt(d))}),clone.find("span.tmem_file_id").each(function(){a(this).text(parseInt(d))}),clone.find(".tmem_repeatable_default_input").each(function(){a(this).val(parseInt(d)).removeAttr("checked")}),clone.find(".search-choice").remove(),clone.find(".chosen-container").remove(),clone},add:function(){a(document.body).on("click",".submit .tmem_add_repeatable",function(b){b.preventDefault();var c=a(this),d=c.parent().parent().prev("tr"),e=i.clone_repeatable(d);e.insertAfter(d).find("input, textarea, select").filter(":visible").eq(0).focus(),e.find(".tmem-select-chosen").chosen({inherit_select_classes:!0,placeholder_text_multiple:tmem_admin_vars.select_months}),e.find(".package-items").css("width","100%")})},move:function(){a(".tmem_repeatable_table tbody").sortable({handle:".tmem_draghandle",items:".tmem_repeatable_row",opacity:.6,cursor:"move",axis:"y",update:function(){var b=0;a(this).find("tr").each(function(){a(this).find("input.tmem_repeatable_index").each(function(){
a(this).val(b)}),b++})}})},remove:function(){a(document.body).on("click",".tmem_remove_repeatable",function(b){b.preventDefault();var c=a(this).parent().parent("tr"),d=c.parent().find("tr").length-1,e=a(this).data("type"),f="tr.tmem_repeatable_"+e+"s";if("price"===e){var g=c.data("key");a('.tmem_repeatable_condition_field option[value="'+g+'"]').remove()}if(d>1)a("input, select",c).val(""),c.fadeOut("fast").remove();else switch(e){case"price":alert(tmem_admin_vars.one_month_min);break;case"item":alert(tmem_admin_vars.one_item_min);break;default:alert(tmem_admin_vars.one_month_min)}a(f).each(function(b){a(this).find("input, select").each(function(){var c=a(this).attr("name");c=c.replace(/\[(\d+)\]/,"["+b+"]"),a(this).attr("name",c).attr("id",c)})})})},price:function(){a(document.body).on("click","#_package_restrict_date",function(){a("#tmem-package-month-selection").toggle("fast")}),a(document.body).on("click","#_addon_restrict_date",function(){a("#tmem-addon-month-selection").toggle("fast")}),a(document.body).on("click","#_package_variable_pricing",function(){a("#tmem-package-variable-price-fields").toggle("fast")}),a(document.body).on("click","#_addon_variable_pricing",function(){a("#tmem-addon-variable-price-fields").toggle("fast")})}};i.init();var j={init:function(){this.content()},content:function(){var b=function(b){var c={recipient:b,action:"tmem_user_events_dropdown"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a("#tmem_email_event").addClass("tmem-updating"),a("#tmem_email_event").fadeTo("slow",.5)},success:function(b){a("#tmem_email_event").empty(),a("#tmem_email_event").append(b.event_list),a("#tmem_email_event").fadeTo("slow",1),a("#tmem_email_event").removeClass("tmem-updating")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})};tmem_admin_vars.load_recipient&&(a("#tmem_email_to").val(tmem_admin_vars.load_recipient),b(tmem_admin_vars.load_recipient)),a(document.body).on("change","#tmem_email_to",function(c){c.preventDefault();var d=a("#tmem_email_to").val();b(d)}),a(document.body).on("change","#tmem_email_template",function(b){b.preventDefault();var c={template:a("#tmem_email_template").val(),action:"tmem_set_email_content"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a("#tmem_email_subject").addClass("tmem-updating"),a("#tmem_email_subject").fadeTo("slow",.5),a("#tmem_email_content").addClass("tmem-updating"),a("#tmem_email_content").fadeTo("slow",.5),a("#tmem_email_template").addClass("tmem-updating"),a("#tmem_email_template").fadeTo("slow",.5),tinymce.execCommand("mceToggleEditor",!1,"tmem_email_content")},success:function(b){"success"===b.type?(a("#tmem_email_content").empty(),tinyMCE.activeEditor.setContent(""),a("#tmem_email_subject").val(b.updated_subject),tinyMCE.activeEditor.setContent(b.updated_content),a("#tmem_email_content").val(b.updated_content)):alert(b.msg),a("#tmem_email_subject").fadeTo("slow",1),a("#tmem_email_subject").removeClass("tmem-updating"),a("#tmem_email_content").fadeTo("slow",1),a("#tmem_email_content").removeClass("tmem-updating"),a("#tmem_email_template").removeClass("tmem-updating"),a("#tmem_email_template").fadeTo("slow",1),tinymce.execCommand("mceToggleEditor",!1,"tmem_email_content")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})})}};j.init();var k={init:function(){this.template_select()},template_select:function(){a(document.body).on("change","#tmem_task_email_template",function(b){b.preventDefault();var c={template:a("#tmem_task_email_template").val(),action:"tmem_get_template_title"};a.ajax({type:"POST",dataType:"json",data:c,url:ajaxurl,beforeSend:function(){a("#tmem-task-email-subject").addClass("tmem-updating"),a("#tmem-task-email-subject").fadeTo("slow",.5)},success:function(b){b.title&&a("#tmem-task-email-subject").val(b.title),a("#tmem-task-email-subject").fadeTo("slow",1),a("#tmem-task-email-subject").removeClass("tmem-updating")}}).fail(function(a){window.console&&window.console.log&&console.log(a)})})}};k.init();var l={init:function(){this.date_options()},date_options:function(){a("#tmem-graphs-date-options").change(function(){var b=a(this),c=a("#tmem-date-range-options");"other"===b.val()?c.show():c.hide()})}};l.init();var m={init:function(){this.submit(),this.dismiss_message()},submit:function(){var b=this;a(document.body).on("submit",".tmem-export-form",function(c){c.preventDefault();var d=a(this).find('input[type="submit"]');if(!d.hasClass("button-disabled")){var e=a(this).serialize();d.addClass("button-disabled"),a(this).find(".notice-wrap").remove(),a(this).append('<div class="notice-wrap"><span class="spinner is-active"></span><div class="tmem-progress"><div></div></div></div>'),b.process_step(1,e,b)}})},process_step:function(b,c,d){a.ajax({type:"POST",url:ajaxurl,data:{form:c,action:"tmem_do_ajax_export",step:b},dataType:"json",success:function(b){if("done"===b.step||b.error||b.success){var e=a(".tmem-export-form").find(".tmem-progress").parent().parent(),f=e.find(".notice-wrap");if(e.find(".button-disabled").removeClass("button-disabled"),b.error){var g=b.message;f.html('<div class="updated error"><p>'+g+"</p></div>")}else if(b.success){var h=b.message;f.html('<div id="tmem-batch-success" class="updated notice is-dismissible"><p>'+h+'<span class="notice-dismiss"></span></p></div>')}else f.remove(),window.location=b.url}else a(".tmem-progress div").animate({width:b.percentage+"%"},50,function(){}),d.process_step(parseInt(b.step),c,d)}}).fail(function(a){window.console&&window.console.log&&console.log(a)})},dismiss_message:function(){a("body").on("click","#tmem-batch-success .notice-dismiss",function(){a("#tmem-batch-success").parent().slideUp("fast")})}};m.init(),"tmem-event_page_tmem-comms"===tmem_admin_vars.current_page&&a("#tmem_form_send_comms").validate({errorClass:"tmem-form-error",validClass:"tmem-form-valid",focusInvalid:!1,rules:{},messages:{tmem_email_to:null,tmem_email_subject:null,tmem_email_content:null}}),tmem_admin_vars.editing_event&&(a("#post").validate({errorClass:"tmem-form-error",validClass:"tmem-form-valid",focusInvalid:!1,rules:{client_name:{required:!0,minlength:1},display_event_date:{required:!0},_tmem_event_cost:{number:!0},_tmem_event_deposit:{number:!0}},messages:{client_name:null,display_event_date:null,_tmem_event_cost:null,_tmem_event_deposit:null}}),a(document.body).on("click","#save-post",function(){if(a("#_tmem_event_cost").val()<"0.01")return confirm(tmem_admin_vars.zero_cost)}))});var tmemFormatCurrency=function(a){var b=parseFloat(a),c=tmem_admin_vars.currency,d=tmem_admin_vars.currency_decimals;return b.toLocaleString(c,{style:"currency",currency:c,minimumFractionDigits:d,maximumFractionDigits:d})},tmemFormatNumber=function(a){var b=parseFloat(a),c=tmem_admin_vars.currency;return b.toLocaleString(c,{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0})},tmemLabelFormatter=function(a){return'<div style="font-size:12px; text-align:center; padding:2px">'+a+"</div>"},tmemLegendFormatterSources=function(a,b){var c=a.toLowerCase().replace(/\s/g,"-"),d='<div class="tmem-legend-color" style="background-color: '+b.color+'"></div>',e='<div class="tmem-pie-legend-item">'+a+": "+Math.round(b.percent)+"% ("+tmemFormatNumber(b.data[0][1])+")</div>",f='<div id="'+b.tmem_vars.id+c+'" class="tmem-legend-item-wrapper">'+d+e+"</div>";return jQuery("#tmem-pie-legend-"+b.tmem_vars.id).append(f),f},tmemLegendFormatterEarnings=function(a,b){var c=a.toLowerCase().replace(/\s/g,"-"),d='<div class="tmem-legend-color" style="background-color: '+b.color+'"></div>',e='<div class="tmem-pie-legend-item">'+a+": "+Math.round(b.percent)+"% ("+tmemFormatCurrency(b.data[0][1])+")</div>",f='<div id="'+b.tmem_vars.id+c+'" class="tmem-legend-item-wrapper">'+d+e+"</div>";return jQuery("#tmem-pie-legend-"+b.tmem_vars.id).append(f),f};